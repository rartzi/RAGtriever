# Multi-Vault Mneme Configuration Example
# This configuration indexes multiple vaults into a shared database,
# enabling cross-vault search while maintaining separate content.

# ============================================
# VAULT DEFINITIONS
# ============================================
# Define each vault with [[vaults]] sections

[[vaults]]
name = "obsidian"
root = "/Users/me/Documents/Obsidian"
ignore = [".git/**", ".obsidian/cache/**", "**/.DS_Store", "**/~$*"]

[[vaults]]
name = "work"
root = "/Users/me/work/documents"
ignore = [".git/**", "**/.DS_Store", "**/node_modules/**", "**/~$*"]

[[vaults]]
name = "research"
root = "/Users/me/research/papers"
# Uses default ignore patterns when not specified
enabled = true  # Can set to false to temporarily exclude a vault

# ============================================
# SHARED INDEX DIRECTORY
# ============================================
# All vaults share this index directory (single SQLite database)

[index]
dir = "~/.mneme/indexes/all-vaults"
extractor_version = "v1"
chunker_version = "v1"

# ============================================
# CHUNKING SETTINGS
# ============================================

[chunking]
overlap_chars = 200       # Overlap between chunks
max_chunk_size = 2000     # Maximum characters per chunk
preserve_heading_metadata = true

# ============================================
# EMBEDDINGS
# ============================================

[embeddings]
provider = "sentence_transformers"
model = "BAAI/bge-small-en-v1.5"
batch_size = 32
device = "cpu"  # cpu, cuda, or mps
offline_mode = true

# Query prefix for asymmetric retrieval (BGE pattern)
use_query_prefix = true
query_prefix = "Represent this sentence for searching relevant passages: "

# Optional FAISS for large-scale vector search (>10K chunks)
# use_faiss = true
# faiss_index_type = "IVF"  # Flat, IVF, or HNSW
# faiss_nlist = 100
# faiss_nprobe = 10

# ============================================
# IMAGE ANALYSIS
# ============================================
# Choose one provider: tesseract, gemini, gemini-service-account, or off

[image_analysis]
provider = "tesseract"  # Local OCR, no API needed

# For Gemini API:
# provider = "gemini"
# gemini_model = "gemini-2.0-flash"
# Set GEMINI_API_KEY environment variable

# For Gemini with service account:
# provider = "gemini-service-account"
# [gemini_service_account]
# project_id = "your-gcp-project-id"
# location = "global"
# credentials_file = "/path/to/service-account.json"
# model = "gemini-2.0-flash-exp"

# ============================================
# RETRIEVAL SETTINGS
# ============================================

[retrieval]
k_vec = 40       # Vector search candidates
k_lex = 40       # Lexical search candidates
top_k = 10       # Final results after merging
use_rerank = false

# Optional reranking (requires sentence-transformers)
# use_rerank = true
# rerank_model = "cross-encoder/ms-marco-MiniLM-L-6-v2"
# rerank_device = "cpu"
# rerank_top_k = 10

# ============================================
# PARALLELIZATION (for scan performance)
# ============================================

[indexing]
extraction_workers = 8    # Parallel file extraction workers (default: 8)
embed_batch_size = 256    # Cross-file embedding batch size
image_workers = 8         # Parallel image API workers (default: 8)
parallel_scan = true      # Enable parallel scanning

# ============================================
# MCP SERVER
# ============================================

[mcp]
transport = "stdio"

# ============================================
# DEFAULT IGNORE PATTERNS
# ============================================
# Applied to vaults that don't specify their own ignore patterns
# Uncomment to customize:
#
# default_ignore = [
#     ".git/**",
#     ".obsidian/cache/**",
#     "**/.DS_Store",
#     "**/~$*",
#     "**/.~lock.*"
# ]

# ============================================
# USAGE EXAMPLES
# ============================================
#
# Scan all vaults:
#   mneme scan --config multi-vault.toml --full
#
# Scan specific vault(s):
#   mneme scan --config multi-vault.toml --full --vaults obsidian
#   mneme scan --config multi-vault.toml --full --vaults obsidian --vaults work
#
# Query all vaults (default):
#   mneme query --config multi-vault.toml "search term"
#
# Query specific vault(s):
#   mneme query --config multi-vault.toml "search term" --vaults research
#
# List configured vaults:
#   mneme list-vaults --config multi-vault.toml
#
# Show status:
#   mneme status --config multi-vault.toml
#
# Watch all vaults for changes:
#   mneme watch --config multi-vault.toml
#
# Watch specific vault(s):
#   mneme watch --config multi-vault.toml --vaults obsidian
